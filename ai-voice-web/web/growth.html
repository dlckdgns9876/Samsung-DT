<!doctype html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <title>초보 육아 웹 – 성장/건강</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        :root {
            --brand: #2563eb;
            --danger: #f97316;
            --text: #111827;
            --muted: #6b7280;
            --bg: #ffffff;
            --card: #ffffff;
            --line: #e5e7eb;
            --shadow: 0 8px 24px rgba(0, 0, 0, .06);
            --radius: 16px;
            --max: 1120px
        }

        * {
            box-sizing: border-box
        }

        a,
        a:visited {
            color: inherit;
            text-decoration: none
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font: 14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, sans-serif
        }

        .container {
            max-width: var(--max);
            margin: 0 auto;
            padding: 0 20px
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(255, 255, 255, .85);
            backdrop-filter: saturate(180%) blur(10px);
            border-bottom: 1px solid var(--line)
        }

        .header-inner {
            height: 56px;
            display: flex;
            gap: 20px;
            align-items: center
        }

        .brand {
            font-weight: 800;
            font-size: 18px
        }

        .nav {
            display: flex;
            gap: 16px;
            color: #4b5563
        }

        .nav a.active {
            color: var(--brand);
            font-weight: 600
        }

        .auth {
            margin-left: auto;
            display: flex;
            gap: 12px;
            color: #374151
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--line);
            padding: 8px 12px;
            border-radius: 10px;
            background: #f9fafb;
            cursor: pointer
        }

        .btn.primary {
            border-color: transparent;
            background: var(--brand);
            color: #fff
        }

        .btn.ghost {
            background: #fff
        }

        main {
            padding: 28px 0 120px
        }

        .grid {
            display: grid;
            gap: 16px
        }

        @media (min-width:900px) {
            .grid {
                grid-template-columns: 1.2fr .8fr
            }
        }

        .card {
            background: var(--card);
            border: 1px solid var(--line);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: var(--shadow)
        }

        .card h3 {
            margin: 0 0 10px;
            font-size: 15px
        }

        .muted {
            color: var(--muted)
        }

        .row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap
        }

        .input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--line);
            border-radius: 10px;
            background: #fff
        }

        .seg {
            display: inline-flex;
            background: #f3f4f6;
            border: 1px solid var(--line);
            border-radius: 12px;
            padding: 4px
        }

        .seg button {
            border: none;
            background: transparent;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            color: #374151
        }

        .seg button.active {
            background: #fff;
            border: 1px solid var(--line);
            color: var(--text)
        }

        .table {
            width: 100%;
            border-collapse: collapse
        }

        .table th,
        .table td {
            border-bottom: 1px solid var(--line);
            padding: 8px 6px;
            text-align: left
        }

        .hint {
            font-size: 12px;
            color: var(--muted)
        }

        .preview-wrap {
            display: flex;
            align-items: center;
            gap: 10px
        }

        .badge {
            font-size: 11px;
            background: #eef2ff;
            border: 1px solid var(--line);
            padding: 4px 8px;
            border-radius: 999px;
            color: #374151
        }

        .footer {
            border-top: 1px solid var(--line);
            padding: 24px 0;
            color: #6b7280
        }

        .tooltip {
            position: absolute;
            pointer-events: none;
            background: #111827;
            color: #fff;
            font-size: 12px;
            padding: 6px 8px;
            border-radius: 8px;
            transform: translate(-50%, -120%);
            white-space: nowrap;
            opacity: 0;
            transition: .12s
        }

        .box {
            border: 1px solid var(--line);
            border-radius: 10px;
            padding: 12px;
            background: #fff;
            white-space: pre-wrap;
            line-height: 1.6
        }

        details.mph {
            margin-top: 12px;
            border: 1px solid var(--line);
            border-radius: 12px;
            padding: 10px 12px;
            background: #fafbff
        }

        details.mph>summary {
            cursor: pointer;
            list-style: none
        }

        details.mph>summary::-webkit-details-marker {
            display: none
        }
    </style>
</head>

<body>
    <!-- HEADER -->
    <header class="header">
        <div class="container header-inner">
            <a class="brand" href="/">초보 육아 웹</a>
            <nav class="nav">
                <a href="/" data-page="home" data-nav="primary"> homes</a>
                <a href="/tts" data-page="tts" data-nav="primary">동화</a>
                <a href="/#behaviors">행동사전</a>
                <a href="/#routines">루틴</a>
                <a href="/growth" data-page="growth" data-nav="primary">성장/건강</a>
                <a href="/#community">커뮤니티</a>
            </nav>
        </div>
    </header>

    <!-- MAIN -->
    <main class="container">
        <!-- Hero -->
        <section class="card" style="display:flex;align-items:center;justify-content:space-between;gap:16px">
            <div>
                <h2 style="margin:0 0 6px;font-size:26px;line-height:1.2">성장/건강 기록</h2>
                <div class="muted">체중·키·머리둘레를 기록하고 그래프로 확인하세요. (로컬 저장)</div>
            </div>
            <div class="badge" id="lastSaved">마지막 저장: -</div>
        </section>

        <section class="grid">
            <!-- 그래프 -->
            <div class="card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                    <h3>그래프</h3>
                    <div class="seg" role="tablist" aria-label="지표 선택">
                        <button id="tab-weight" class="active" data-metric="weight">체중(kg)</button>
                        <button id="tab-height" data-metric="height">키(cm)</button>
                        <button id="tab-head" data-metric="head">머리둘레(cm)</button>
                    </div>
                </div>
                <div style="position:relative">
                    <canvas id="chart" style="width:100%;height:320px;border-radius:12px;background:#fff"></canvas>
                    <div id="tooltip" class="tooltip"></div>
                </div>
                <div style="margin-top:12px" class="preview-wrap">
                    <img id="previewImg" alt="홈 미리보기 썸네일"
                        style="height:56px;border:1px solid var(--line);border-radius:10px;background:#f8fafc" />
                    <div class="hint">그래프가 그려질 때마다 <strong>홈</strong> 썸네일을 자동 생성합니다.</div>
                </div>
                <canvas id="previewCanvas" width="560" height="100" style="display:none"></canvas>
            </div>

            <!-- 기록 추가 / 데이터 -->
            <div class="card">
                <h3>기록 추가</h3>
                <div class="row">
                    <input id="dateInput" type="date" class="input" style="flex:1 0 140px" />
                    <input id="wInput" type="number" step="0.01" placeholder="체중(kg)" class="input"
                        style="flex:1 0 120px" />
                    <input id="hInput" type="number" step="0.1" placeholder="키(cm)" class="input"
                        style="flex:1 0 120px" />
                    <input id="hdInput" type="number" step="0.1" placeholder="머리둘레(cm)" class="input"
                        style="flex:1 0 120px" />
                    <button class="btn primary" id="addBtn">추가</button>
                </div>

                <!-- 부모 키 예측을 기록 추가 카드 안으로 이동 (접기/펼치기) -->
                <details class="mph" open>
                    <summary><strong>부모 키 기반 성인 키 예측 (MPH)</strong> <span class="muted" style="font-weight:400">· 간단
                            참고치</span></summary>
                    <div class="row" style="margin-top:8px">
                        <input id="momH" type="number" step="0.1" placeholder="엄마 키 (cm)" class="input"
                            style="flex:1 0 140px" />
                        <input id="dadH" type="number" step="0.1" placeholder="아빠 키 (cm)" class="input"
                            style="flex:1 0 140px" />
                    </div>
                    <div class="row" style="align-items:center;justify-content:space-between;margin-top:8px">
                        <div class="seg" role="tablist" aria-label="아기 성별">
                            <button id="sex-boy" class="active" data-sex="boy">남아</button>
                            <button id="sex-girl" data-sex="girl">여아</button>
                        </div>
                        <span class="hint">공식: 남아 (엄+부+13)÷2 · 여아 (엄+부−13)÷2 · 범위 ±8.5cm</span>
                    </div>
                    <div id="predBox" class="box" style="margin-top:10px;min-height:56px">부모 키와 성별을 입력하면 예측이 표시됩니다.
                    </div>
                </details>

                <div style="margin-top:14px" class="row">
                    <button class="btn" id="exportBtn">JSON 내보내기</button>
                    <label class="btn">JSON 불러오기
                        <input id="importFile" type="file" accept="application/json" style="display:none">
                    </label>
                    <button class="btn" id="clearBtn">전체 초기화</button>
                </div>
            </div>

            <!-- 표 -->
            <div class="card" style="grid-column:1 / -1">
                <h3>기록표</h3>
                <table class="table" id="dataTable" aria-describedby="표 설명">
                    <thead>
                        <tr>
                            <th style="width:140px">날짜</th>
                            <th>체중(kg)</th>
                            <th>키(cm)</th>
                            <th>머리둘레(cm)</th>
                            <th style="width:80px">삭제</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="hint">* 최근 날짜가 위에 오도록 정렬됩니다.</div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container muted">© 2025 육아 도래(이) · All Rights Reserved.</div>
    </footer>

    <script>
        /***********************
         * 유틸 & 스토리지
         ************************/
        const LS_KEY = 'growth_records_v1', PREVIEW_KEY = 'growth_preview_png', PREVIEW_META_KEY = 'growth_preview_meta', MPH_KEY = 'parent_height_info_v1';
        const fmt = (n, d = 2) => (n ?? '').toString() === '' ? '' : Number(n).toFixed(d);
        const todayStr = () => new Date().toISOString().slice(0, 10);
        const num = v => (v === '' || v == null) ? null : Number(v);

        function seed8weeks() {
            const base = new Date(); base.setDate(base.getDate() - 7 * 7);
            const rows = []; let w = 6.2, h = 62.0, head = 40.5;
            for (let i = 0; i < 8; i++) {
                const d = new Date(base); d.setDate(base.getDate() + i * 7);
                w += (Math.random() * 0.25 + 0.05); h += (Math.random() * 0.6 + 0.2); head += (Math.random() * 0.15 + 0.03);
                rows.push({ date: d.toISOString().slice(0, 10), weight: +w.toFixed(2), height: +h.toFixed(1), head: +head.toFixed(1) });
            }
            return rows;
        }
        function load() {
            try {
                const raw = localStorage.getItem(LS_KEY); if (!raw) return seed8weeks();
                const arr = JSON.parse(raw); if (!Array.isArray(arr)) return seed8weeks();
                return arr.map(r => ({ date: r.date, weight: num(r.weight), height: num(r.height), head: num(r.head) }));
            } catch (e) { return seed8weeks(); }
        }
        function save(rows) { localStorage.setItem(LS_KEY, JSON.stringify(rows)); document.getElementById('lastSaved').textContent = '마지막 저장: ' + new Date().toLocaleString(); }

        /*********************** 상태 ***********************/
        let rows = load(); let metric = 'weight';

        /*********************** DOM ***********************/
        const dateInput = document.getElementById('dateInput'), wInput = document.getElementById('wInput'), hInput = document.getElementById('hInput'), hdInput = document.getElementById('hdInput'), addBtn = document.getElementById('addBtn'), exportBtn = document.getElementById('exportBtn'), importFile = document.getElementById('importFile'), clearBtn = document.getElementById('clearBtn'), dataTable = document.getElementById('dataTable').querySelector('tbody'), chart = document.getElementById('chart'), tooltip = document.getElementById('tooltip'), previewCanvas = document.getElementById('previewCanvas'), previewImg = document.getElementById('previewImg');
        // MPH
        const momH = document.getElementById('momH'), dadH = document.getElementById('dadH'), sexBoy = document.getElementById('sex-boy'), sexGirl = document.getElementById('sex-girl'), predBox = document.getElementById('predBox');

        dateInput.value = todayStr();

        /*********************** 표 렌더 ***********************/
        function renderTable() {
            rows.sort((a, b) => a.date < b.date ? 1 : -1);
            dataTable.innerHTML = rows.map((r, i) => `
        <tr>
          <td>${r.date}</td><td>${fmt(r.weight)}</td><td>${fmt(r.height, 1)}</td><td>${fmt(r.head, 1)}</td>
          <td><button class="btn" data-del="${i}">삭제</button></td>
        </tr>`).join('');
            dataTable.querySelectorAll('button[data-del]').forEach(btn => {
                btn.onclick = () => { const idx = Number(btn.getAttribute('data-del')); rows.splice(idx, 1); save(rows); renderTable(); drawAll(); };
            });
        }

        /*********************** 차트 ***********************/
        function drawAll() { drawChart(chart, rows, metric); drawPreviewAndSave(rows, metric); }
        function getDataForMetric(rows, metric) {
            return rows.filter(r => r[metric] != null).slice().sort((a, b) => a.date > b.date ? 1 : -1).map(r => ({ x: new Date(r.date).getTime(), y: Number(r[metric]), date: r.date }));
        }
        function drawChart(canvas, rows, metric) {
            const data = getDataForMetric(rows, metric), ctx = canvas.getContext('2d'), cssW = canvas.clientWidth, cssH = 320, dpr = Math.min(window.devicePixelRatio || 1, 2);
            canvas.width = cssW * dpr; canvas.height = cssH * dpr; canvas.style.height = cssH + 'px'; ctx.scale(dpr, dpr); ctx.clearRect(0, 0, cssW, cssH);
            const pad = { l: 44, r: 16, t: 16, b: 28 }, W = cssW - pad.l - pad.r, H = cssH - pad.t - pad.b; ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, cssW, cssH);
            if (!data.length) { ctx.fillStyle = '#6b7280'; ctx.fillText('데이터가 없습니다.', pad.l, pad.t + 20); return; }
            const xs = data.map(d => d.x), ys = data.map(d => d.y), minX = Math.min(...xs), maxX = Math.max(...xs), rangeX = maxX - minX || 1, minY = Math.floor(Math.min(...ys) * 0.98), maxY = Math.ceil(Math.max(...ys) * 1.02), rangeY = maxY - minY || 1, xToPx = x => pad.l + ((x - minX) / rangeX) * W, yToPx = y => pad.t + (1 - ((y - minY) / rangeY)) * H;
            ctx.strokeStyle = '#e5e7eb'; ctx.lineWidth = 1; ctx.beginPath(); for (let i = 0; i <= 5; i++) { const y = pad.t + (i / 5) * H; ctx.moveTo(pad.l, y); ctx.lineTo(pad.l + W, y); } ctx.stroke();
            ctx.beginPath(); data.forEach((p, idx) => { const x = xToPx(p.x), y = yToPx(p.y); if (idx === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y); }); ctx.lineWidth = 2.2; ctx.strokeStyle = '#2563eb'; ctx.stroke();
            ctx.fillStyle = '#2563eb'; data.forEach(p => { const x = xToPx(p.x), y = yToPx(p.y); ctx.beginPath(); ctx.arc(x, y, 3, 0, Math.PI * 2); ctx.fill(); });
            ctx.fillStyle = '#6b7280'; ctx.font = '12px system-ui'; for (let i = 0; i <= 5; i++) { const v = minY + (i / 5) * rangeY, y = pad.t + (1 - i / 5) * H + 4; ctx.fillText(v.toFixed(metric === 'weight' ? 2 : 1), 6, y); }
            [minX, minX + rangeX / 2, maxX].forEach(x => { const d = new Date(x), s = `${(d.getMonth() + 1)}/${d.getDate()}`, tx = xToPx(x) - 10, ty = pad.t + H + 18; ctx.fillText(s, tx, ty); });
            const pts = data.map(p => ({ x: xToPx(p.x), y: yToPx(p.y), raw: p }));
            canvas.onmousemove = e => { const rect = canvas.getBoundingClientRect(), mx = (e.clientX - rect.left); let nearest = null, best = 99999; pts.forEach(pt => { const d = Math.abs(pt.x - mx); if (d < best) { best = d; nearest = pt; } }); if (nearest && best < 30) { tooltip.style.opacity = 1; tooltip.style.left = nearest.x + 'px'; tooltip.style.top = nearest.y + 'px'; tooltip.textContent = `${nearest.raw.date} • ${nearest.raw.y}${metric === 'weight' ? 'kg' : 'cm'}`; } else tooltip.style.opacity = 0; };
            canvas.onmouseleave = () => tooltip.style.opacity = 0;
        }
        function drawPreviewAndSave(rows, metric) {
            const data = getDataForMetric(rows, metric), c = previewCanvas, ctx = c.getContext('2d'), W = c.width, H = c.height; ctx.clearRect(0, 0, W, H);
            const g = ctx.createLinearGradient(0, 0, 0, H); g.addColorStop(0, '#f8fafc'); g.addColorStop(1, '#eef2ff'); ctx.fillStyle = g; ctx.fillRect(0, 0, W, H);
            if (data.length) {
                const xs = data.map(d => d.x), ys = data.map(d => d.y), minX = Math.min(...xs), maxX = Math.max(...xs), rangeX = maxX - minX || 1, minY = Math.min(...ys), maxY = Math.max(...ys), rangeY = (maxY - minY) || 1, x = v => ((v - minX) / rangeX) * (W - 20) + 10, y = v => (1 - ((v - minY) / rangeY)) * (H - 20) + 10;
                ctx.beginPath(); data.forEach((p, i) => { const xp = x(p.x), yp = y(p.y); if (i === 0) ctx.moveTo(xp, yp); else ctx.lineTo(xp, yp); }); ctx.lineTo(x(maxX), H - 10); ctx.lineTo(x(minX), H - 10); ctx.closePath(); ctx.fillStyle = 'rgba(37,99,235,0.14)'; ctx.fill();
                ctx.beginPath(); data.forEach((p, i) => { const xp = x(p.x), yp = y(p.y); if (i === 0) ctx.moveTo(xp, yp); else ctx.lineTo(xp, yp); }); ctx.lineWidth = 2; ctx.strokeStyle = '#2563eb'; ctx.stroke();
            }
            const url = c.toDataURL('image/png'); localStorage.setItem(PREVIEW_KEY, url); localStorage.setItem(PREVIEW_META_KEY, JSON.stringify({ metric, updated: new Date().toISOString() })); previewImg.src = url;
        }

        /*********************** 기록 이벤트 ***********************/
        document.getElementById('tab-weight').onclick = e => setMetric('weight', e.target);
        document.getElementById('tab-height').onclick = e => setMetric('height', e.target);
        document.getElementById('tab-head').onclick = e => setMetric('head', e.target);
        function setMetric(m, btn) { metric = m; document.querySelectorAll('.seg button[data-metric]').forEach(b => b.classList.toggle('active', b === btn)); drawAll(); }
        addBtn.onclick = () => { const d = dateInput.value || todayStr(), w = num(wInput.value), h = num(hInput.value), hd = num(hdInput.value); if (w == null && h == null && hd == null) { alert('적어도 하나의 값을 입력하세요.'); return; } const i = rows.findIndex(r => r.date === d); const rec = { date: d, weight: w, height: h, head: hd }; if (i >= 0) rows[i] = { ...rows[i], ...rec }; else rows.push(rec); save(rows); renderTable(); drawAll(); wInput.value = ''; hInput.value = ''; hdInput.value = ''; };
        exportBtn.onclick = () => { const blob = new Blob([JSON.stringify(rows, null, 2)], { type: 'application/json' }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'growth_records.json'; a.click(); URL.revokeObjectURL(a.href); };
        importFile.onchange = e => { const f = e.target.files[0]; if (!f) return; const r = new FileReader(); r.onload = () => { try { const arr = JSON.parse(r.result); if (Array.isArray(arr)) { rows = arr; save(rows); renderTable(); drawAll(); } else alert('형식이 올바르지 않습니다.'); } catch (err) { alert('JSON 파싱 오류'); } }; r.readAsText(f); importFile.value = ''; };
        clearBtn.onclick = () => { if (!confirm('모든 기록을 삭제할까요?')) return; rows = []; save(rows); renderTable(); drawAll(); };

        /*********************** MPH 예측 ***********************/
        function mphPredict(mom, dad, sex) { if (!Number.isFinite(mom) || !Number.isFinite(dad)) return null; const base = (sex === 'boy') ? (dad + mom + 13) / 2 : (dad + mom - 13) / 2; return { base, low: base - 8.5, high: base + 8.5 }; }
        function saveMPHState() { const state = { mom: num(momH.value), dad: num(dadH.value), sex: sexBoy.classList.contains('active') ? 'boy' : 'girl' }; localStorage.setItem(MPH_KEY, JSON.stringify(state)); }
        function renderMPH() { const s = JSON.parse(localStorage.getItem(MPH_KEY) || '{}'); if (s.mom != null) momH.value = s.mom; if (s.dad != null) dadH.value = s.dad; if (s.sex === 'girl') { sexBoy.classList.remove('active'); sexGirl.classList.add('active'); } else { sexGirl.classList.remove('active'); sexBoy.classList.add('active'); } updateMPH(); }
        function updateMPH() {
            const mom = num(momH.value), dad = num(dadH.value), sex = sexBoy.classList.contains('active') ? 'boy' : 'girl', r = mphPredict(mom, dad, sex); if (!r) { predBox.textContent = '부모 키와 성별을 입력하면 예측이 표시됩니다.'; saveMPHState(); return; }
            predBox.innerHTML = `<div><strong>예상 성인 키:</strong> ${r.base.toFixed(1)} cm <span class="muted">(범위 ${r.low.toFixed(1)} ~ ${r.high.toFixed(1)} cm)</span></div><div class="hint" style="margin-top:6px">* 영양, 수면, 운동, 건강, 사춘기 시기 등으로 오차가 발생할 수 있어요.</div>`; saveMPHState();
        }
        momH.addEventListener('input', updateMPH); dadH.addEventListener('input', updateMPH);
        sexBoy.addEventListener('click', () => { sexBoy.classList.add('active'); sexGirl.classList.remove('active'); updateMPH(); });
        sexGirl.addEventListener('click', () => { sexGirl.classList.add('active'); sexBoy.classList.remove('active'); updateMPH(); });

        /*********************** 초기 렌더 ***********************/
        renderTable(); const prev = localStorage.getItem(PREVIEW_KEY); if (prev) previewImg.src = prev; drawAll(); document.getElementById('lastSaved').textContent = '마지막 저장: ' + new Date().toLocaleString(); renderMPH();
    </script>

    <script>
        (function () {
            const file = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
            let current = 'home'; if (file.includes('tts')) current = 'tts'; else if (file.includes('growth')) current = 'growth';
            document.querySelectorAll('.nav a[data-page]').forEach(a => { a.classList.toggle('active', a.dataset.page === current); });
        })();
    </script>
</body>

</html>